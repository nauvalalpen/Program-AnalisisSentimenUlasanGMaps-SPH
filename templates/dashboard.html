{% extends 'base.html' %} {% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
  <div class="mb-8">
    <h2 class="text-3xl font-bold text-slate-800">Dashboard Analisis</h2>
    <p class="text-slate-500">
      Upload data, latih multi-model, dan analisis sentimen secara mendalam.
    </p>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
    <!-- KOLOM KIRI (Upload & Training) - Lebar 4 -->
    <div class="lg:col-span-4 space-y-6">
      <!-- Upload Card -->
      <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
        <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
          ğŸ“‚ Upload Dataset
        </h3>
        <input
          type="file"
          id="fileInput"
          accept=".xlsx"
          class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-50 file:text-red-700 hover:file:bg-red-100 mb-4"
        />
        <button
          onclick="uploadAndTrain()"
          class="w-full bg-slate-900 text-white py-2 rounded-lg font-medium hover:bg-slate-800 transition shadow-lg"
        >
          ğŸš€ Latih Semua Model
        </button>
        <p id="trainStatus" class="mt-3 text-sm text-center text-slate-500"></p>
      </div>

      <!-- Tabel Evaluasi Model (Hidden Awalnya) -->
      <div
        id="modelStats"
        class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 hidden"
      >
        <h3 class="text-lg font-bold mb-3">ğŸ† Perbandingan Model</h3>
        <div class="overflow-x-auto">
          <table class="w-full text-sm text-left">
            <thead class="text-xs text-slate-500 uppercase bg-slate-50">
              <tr>
                <th class="px-3 py-2">Model</th>
                <th class="px-3 py-2">Akurasi</th>
                <th class="px-3 py-2">F1</th>
              </tr>
            </thead>
            <tbody id="evalTableBody" class="text-slate-700">
              <!-- Diisi via JS -->
            </tbody>
          </table>
        </div>
        <div class="mt-6 pt-4 border-t border-slate-100">
          <h4 class="text-sm font-bold text-slate-800 mb-2">
            ğŸ“„ Laporan Manajerial
          </h4>
          <p class="text-xs text-slate-500 mb-3">
            Unduh ringkasan analisis untuk presentasi rapat.
          </p>
          <a
            href="/api/download_report"
            target="_blank"
            class="block w-full text-center bg-white border border-slate-300 text-slate-700 py-2 rounded-lg text-sm font-semibold hover:bg-slate-50 hover:text-red-700 transition"
          >
            ğŸ“¥ Download Laporan PDF
          </a>
        </div>
        <p class="text-xs text-slate-400 mt-2">
          *Model terbaik ditandai otomatis.
        </p>
      </div>
    </div>

    <!-- KOLOM KANAN (Prediksi & Wordcloud) - Lebar 8 -->
    <div class="lg:col-span-8 space-y-6">
      <!-- Card Uji Prediksi -->
      <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
        <h3 class="text-lg font-bold mb-4">ğŸ”® Uji Prediksi Real-time</h3>
        <div class="flex flex-col sm:flex-row gap-4">
          <input
            type="text"
            id="predictInput"
            placeholder="Tulis ulasan pasien disini..."
            class="flex-1 border border-slate-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-red-500 outline-none"
          />

          <!-- Dropdown Pilih Model -->
          <select
            id="modelSelect"
            class="border border-slate-300 rounded-lg px-3 py-2 bg-white text-slate-700 focus:ring-2 focus:ring-red-500 outline-none"
          >
            <option value="Naive Bayes">Naive Bayes</option>
            <option value="SVM">SVM</option>
            <option value="Logistic Regression">Log. Regression</option>
          </select>

          <button
            onclick="predictSentiment()"
            class="bg-red-700 text-white px-6 py-2 rounded-lg font-medium hover:bg-red-800 transition"
          >
            Analisis
          </button>
        </div>

        <!-- Hasil -->
        <div id="resultArea" class="mt-6 hidden animate-fade-in">
          <div
            class="flex items-center gap-4 p-4 rounded-lg border"
            id="resultBox"
          >
            <div class="text-4xl" id="resultIcon">ğŸ¤”</div>
            <div>
              <h4 class="text-xl font-bold" id="resultLabel">Label</h4>
              <p class="text-sm text-slate-600">
                Confidence: <span id="resultConf" class="font-bold">0%</span>
                <span class="text-slate-400 mx-2">|</span>
                Model: <span id="resultModel">NB</span>
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Card Dual Wordcloud (Hidden Awalnya) -->
      <div id="wcContainer" class="hidden">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- WC Positif -->
          <div
            class="bg-white p-4 rounded-xl shadow-sm border border-green-200"
          >
            <h4 class="text-green-700 font-bold mb-2 flex items-center gap-2">
              ğŸ˜Š Ulasan Positif
            </h4>
            <div
              class="aspect-w-16 aspect-h-9 bg-slate-50 rounded-lg overflow-hidden"
            >
              <img id="wcPos" src="" class="object-cover w-full h-full" />
            </div>
          </div>

          <!-- WC Negatif -->
          <div class="bg-white p-4 rounded-xl shadow-sm border border-red-200">
            <h4 class="text-red-700 font-bold mb-2 flex items-center gap-2">
              ğŸ˜¡ Ulasan Negatif
            </h4>
            <div
              class="aspect-w-16 aspect-h-9 bg-slate-50 rounded-lg overflow-hidden"
            >
              <img id="wcNeg" src="" class="object-cover w-full h-full" />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
