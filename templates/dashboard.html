{% extends "base.html" %} {% block content %}

<section class="py-8 lg:py-12 bg-slate-50 min-h-screen">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header & Controls -->
    <div
      class="flex flex-col lg:flex-row justify-between items-start lg:items-end gap-6 mb-10"
      data-aos="fade-up"
    >
      <!-- Title -->
      <div>
        <h1 class="text-3xl font-black text-slate-900 tracking-tight mb-2">
          Dashboard Monitoring
        </h1>
        <div class="flex items-center space-x-2 text-slate-500">
          <span class="relative flex h-2.5 w-2.5">
            <span
              class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"
            ></span>
            <span
              class="relative inline-flex rounded-full h-2.5 w-2.5 bg-emerald-500"
            ></span>
          </span>
          <p class="text-sm font-medium">Sistem Live & Real-time</p>
        </div>
      </div>

      <!-- Time Filter (Segmented Control Style) -->
      <div
        class="bg-white p-1.5 rounded-xl border border-slate-200 shadow-sm inline-flex"
      >
        {% set periods = [('day', 'Hari Ini'), ('week', 'Minggu Ini'), ('month',
        'Bulan Ini'), ('all', 'Semua Data')] %} {% for key, label in periods %}
        <a
          href="?timeframe={{ key }}"
          class="px-4 py-2 rounded-lg text-sm font-semibold transition-all duration-200 {% if timeframe == key %} bg-brand-600 text-white shadow-md {% else %} text-slate-500 hover:text-slate-900 hover:bg-slate-50 {% endif %}"
        >
          {{ label }}
        </a>
        {% endfor %}
      </div>
    </div>

    <!-- Overall Statistics (KPI Cards) -->
    {% if stats|length > 0 %}
    <div
      class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10"
      data-aos="fade-up"
      data-aos-delay="100"
    >
      {% set total_reviews = namespace(value=0) %} {% set total_positive =
      namespace(value=0) %} {% set total_negative = namespace(value=0) %} {% for
      name, info in stats.items() %} {% set total_reviews.value =
      total_reviews.value + info.total %} {% set total_positive.value =
      total_positive.value + info.pos %} {% set total_negative.value =
      total_negative.value + info.neg %} {% endfor %} {% set overall_percentage
      = ((total_positive.value / total_reviews.value * 100) | round(1)) if
      total_reviews.value > 0 else 0 %}

      <!-- KPI 1: Total Volume -->
      <div
        class="bg-white rounded-xl p-6 border border-slate-200 shadow-sm relative overflow-hidden group"
      >
        <div class="flex justify-between items-start mb-4">
          <div>
            <p
              class="text-sm font-bold text-slate-400 uppercase tracking-wider"
            >
              Total Laporan
            </p>
            <h3 class="text-3xl font-black text-slate-900 mt-1">
              {{ total_reviews.value }}
            </h3>
          </div>
          <div
            class="w-10 h-10 bg-brand-50 rounded-lg flex items-center justify-center text-brand-600"
          >
            <i class="fas fa-file-medical-alt text-lg"></i>
          </div>
        </div>
        <div class="flex items-center text-xs text-slate-500">
          <i class="fas fa-hospital mr-1.5"></i>
          <span>Dari {{ stats|length }} Fasilitas Kesehatan</span>
        </div>
        <div
          class="absolute bottom-0 left-0 h-1 bg-brand-600 w-full transform scale-x-0 group-hover:scale-x-100 transition-transform origin-left duration-500"
        ></div>
      </div>

      <!-- KPI 2: Positive Sentiment -->
      <div
        class="bg-white rounded-xl p-6 border border-slate-200 shadow-sm relative overflow-hidden group"
      >
        <div class="flex justify-between items-start mb-4">
          <div>
            <p
              class="text-sm font-bold text-slate-400 uppercase tracking-wider"
            >
              Sentimen Positif
            </p>
            <h3 class="text-3xl font-black text-slate-900 mt-1">
              {{ total_positive.value }}
            </h3>
          </div>
          <div
            class="w-10 h-10 bg-emerald-50 rounded-lg flex items-center justify-center text-emerald-600"
          >
            <i class="fas fa-smile text-lg"></i>
          </div>
        </div>
        <div class="flex items-center text-xs text-emerald-600 font-bold">
          <i class="fas fa-chart-pie mr-1.5"></i>
          <span>{{ overall_percentage }}% Kepuasan Pasien</span>
        </div>
        <div
          class="absolute bottom-0 left-0 h-1 bg-emerald-500 w-full transform scale-x-0 group-hover:scale-x-100 transition-transform origin-left duration-500"
        ></div>
      </div>

      <!-- KPI 3: Negative Sentiment -->
      <div
        class="bg-white rounded-xl p-6 border border-slate-200 shadow-sm relative overflow-hidden group"
      >
        <div class="flex justify-between items-start mb-4">
          <div>
            <p
              class="text-sm font-bold text-slate-400 uppercase tracking-wider"
            >
              Keluhan / Negatif
            </p>
            <h3 class="text-3xl font-black text-slate-900 mt-1">
              {{ total_negative.value }}
            </h3>
          </div>
          <div
            class="w-10 h-10 bg-rose-50 rounded-lg flex items-center justify-center text-rose-600"
          >
            <i class="fas fa-frown text-lg"></i>
          </div>
        </div>
        <div class="flex items-center text-xs text-rose-600 font-bold">
          <i class="fas fa-exclamation-circle mr-1.5"></i>
          <span
            >{{ (100 - overall_percentage) | round(1) }}% Perlu Perbaikan</span
          >
        </div>
        <div
          class="absolute bottom-0 left-0 h-1 bg-rose-500 w-full transform scale-x-0 group-hover:scale-x-100 transition-transform origin-left duration-500"
        ></div>
      </div>
    </div>
    {% endif %}

    <!-- Hospital Detail Grid -->
    <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
      {% for name, info in stats.items() %}
      <div
        class="bg-white rounded-2xl border border-slate-200 shadow-sm hover:shadow-lg transition-all duration-300 overflow-hidden"
        data-aos="fade-up"
        data-aos-delay="{{ loop.index0 * 50 }}"
      >
        <!-- Card Header -->
        <div
          class="px-6 py-5 border-b border-slate-100 flex justify-between items-center bg-slate-50/50"
        >
          <div class="flex items-center space-x-3">
            <div
              class="w-10 h-10 rounded-full flex items-center justify-center text-white shadow-sm {% if info.score >= 70 %} bg-emerald-500 {% elif info.score >= 50 %} bg-amber-500 {% else %} bg-rose-500 {% endif %}"
            >
              <span class="font-bold text-sm">{{ info.score }}%</span>
            </div>
            <div>
              <h3 class="font-bold text-slate-800 text-lg leading-tight">
                {{ name }}
              </h3>
              <p class="text-xs text-slate-500">Update terakhir: Real-time</p>
            </div>
          </div>

          <div class="text-right">
            <span
              class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {% if info.score >= 70 %} bg-emerald-100 text-emerald-800 {% elif info.score >= 50 %} bg-amber-100 text-amber-800 {% else %} bg-rose-100 text-rose-800 {% endif %}"
            >
              {% if info.score >= 70 %} Sangat Baik {% elif info.score >= 50 %}
              Cukup {% else %} Kritis {% endif %}
            </span>
          </div>
        </div>

        <!-- Card Body -->
        <div class="p-6">
          <!-- Progress Bar Visualization -->
          <div class="mb-6">
            <div class="flex justify-between text-sm font-semibold mb-2">
              <span class="text-slate-600">Distribusi Sentimen</span>
              <span class="text-slate-400 text-xs"
                >{{ info.total }} Total Ulasan</span
              >
            </div>

            <div class="relative h-4 bg-slate-100 rounded-full overflow-hidden">
              <!-- Stacked Bar -->
              <div class="flex h-full w-full">
                <!-- Positive Part -->
                <div
                  class="h-full bg-emerald-500 transition-all duration-1000 ease-out progress-bar relative group/tooltip"
                  style="width: 0%"
                  data-width="{{ info.score }}%"
                >
                  <div class="absolute inset-0 bg-white/20"></div>
                </div>
                <!-- Negative Part -->
                <div
                  class="h-full bg-rose-500 transition-all duration-1000 ease-out progress-bar"
                  style="width: 0%"
                  data-width="{{ 100 - info.score }}%"
                ></div>
              </div>
            </div>

            <div class="flex justify-between mt-2 text-xs">
              <div class="text-emerald-600 font-bold flex items-center">
                <div class="w-2 h-2 rounded-full bg-emerald-500 mr-1.5"></div>
                Positif ({{ info.pos }})
              </div>
              <div class="text-rose-600 font-bold flex items-center">
                Negatif ({{ info.neg }})
                <div class="w-2 h-2 rounded-full bg-rose-500 ml-1.5"></div>
              </div>
            </div>
          </div>

          <!-- Quick Analysis -->
          <div class="bg-slate-50 rounded-lg p-4 border border-slate-100">
            <div class="flex items-start space-x-3">
              <i
                class="fas fa-stethoscope mt-1 {% if info.score >= 70 %} text-emerald-500 {% elif info.score >= 50 %} text-amber-500 {% else %} text-rose-500 {% endif %}"
              ></i>
              <div>
                <h4 class="text-sm font-bold text-slate-800 mb-1">
                  Diagnostik AI
                </h4>
                <p class="text-xs text-slate-500 leading-relaxed">
                  {% if info.score >= 80 %} Kualitas pelayanan sangat prima.
                  Mayoritas pasien merasa puas dengan fasilitas dan kinerja
                  tenaga medis. {% elif info.score >= 60 %} Pelayanan cukup
                  baik, namun terdapat beberapa keluhan yang perlu diperhatikan
                  manajemen untuk peningkatan mutu. {% else %} Terdeteksi
                  lonjakan sentimen negatif. Disarankan untuk segera
                  mengevaluasi prosedur layanan dan fasilitas terkait. {% endif
                  %}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Empty State -->
    {% if stats|length == 0 %}
    <div
      class="flex flex-col items-center justify-center py-24 bg-white rounded-3xl border border-dashed border-slate-300 text-center"
      data-aos="zoom-in"
    >
      <div
        class="w-20 h-20 bg-slate-50 rounded-full flex items-center justify-center mb-6"
      >
        <i class="fas fa-clipboard-list text-3xl text-slate-400"></i>
      </div>
      <h3 class="text-xl font-bold text-slate-900 mb-2">
        Belum Ada Data Statistik
      </h3>
      <p class="text-slate-500 max-w-md mb-8">
        Belum ada laporan masuk untuk rentang waktu ini. Jadilah yang pertama
        memberikan penilaian.
      </p>
      <a
        href="{{ url_for('input_page') }}"
        class="px-6 py-3 bg-brand-600 text-white rounded-lg font-semibold hover:bg-brand-700 transition-colors shadow-lg shadow-brand-500/30"
      >
        <i class="fas fa-plus mr-2"></i>Buat Laporan Baru
      </a>
    </div>
    {% endif %}

    <!-- System Status Footer -->
    {% if stats|length > 0 %}
    <div class="mt-12 pt-8 border-t border-slate-200">
      <div
        class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center md:text-left"
      >
        <div
          class="flex items-center justify-center md:justify-start space-x-3 text-slate-500"
        >
          <i class="fas fa-server text-brand-500"></i>
          <span class="text-sm"
            >Server Status:
            <span class="text-emerald-600 font-bold">Online</span></span
          >
        </div>
        <div
          class="flex items-center justify-center md:justify-start space-x-3 text-slate-500"
        >
          <i class="fas fa-database text-brand-500"></i>
          <span class="text-sm"
            >Last Sync:
            <span class="font-mono text-slate-700">Just Now</span></span
          >
        </div>
        <div
          class="flex items-center justify-center md:justify-start space-x-3 text-slate-500"
        >
          <i class="fas fa-shield-alt text-brand-500"></i>
          <span class="text-sm"
            >Data Encryption:
            <span class="text-brand-700 font-bold">AES-256</span></span
          >
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</section>

<script>
  // Animate progress bars smoothly on load
  document.addEventListener("DOMContentLoaded", function () {
    // Delay slightly to allow layout to settle
    setTimeout(() => {
      const progressBars = document.querySelectorAll(".progress-bar");
      progressBars.forEach((bar) => {
        const targetWidth = bar.getAttribute("data-width");
        bar.style.width = targetWidth;
      });
    }, 200);
  });
</script>

{% endblock %}
