{% extends "base.html" %} {% block content %}

<!-- Custom Color Palette Injection for this page -->
<style>
  /* Premium Color Palette inspired by modern dashboards */
  :root {
    --primary-bg: #f8fafc;
    --card-bg: #ffffff;
    --text-main: #1e293b;
    --text-sub: #64748b;
    --accent-success: #10b981; /* Emerald 500 */
    --accent-warning: #f59e0b; /* Amber 500 */
    --accent-danger: #ef4444; /* Red 500 */
    --brand-blue: #2563eb; /* Blue 600 */
  }
</style>

<section
  class="py-8 lg:py-12 min-h-screen"
  style="background-color: var(--primary-bg)"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header Section -->
    <div
      class="flex flex-col md:flex-row justify-between items-start md:items-end gap-6 mb-12"
      data-aos="fade-down"
    >
      <div>
        <h1
          class="text-3xl lg:text-4xl font-extrabold tracking-tight mb-2"
          style="color: var(--text-main)"
        >
          Live Monitoring Dashboard
        </h1>
        <div class="flex items-center gap-3">
          <span class="relative flex h-3 w-3">
            <span
              class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"
            ></span>
            <span
              class="relative inline-flex rounded-full h-3 w-3 bg-green-500"
            ></span>
          </span>
          <p class="text-sm font-medium text-slate-500">
            Real-time Data Updates â€¢
            <span class="font-mono text-slate-400">SYNC: LIVE</span>
          </p>
        </div>
      </div>

      <!-- Time Filter Pills -->
      <div
        class="bg-white p-1.5 rounded-full shadow-sm border border-slate-200 flex overflow-x-auto max-w-full"
      >
        {% set periods = [('day', '24H'), ('week', '7 Days'), ('month', '30
        Days'), ('all', 'All Time')] %} {% for key, label in periods %}
        <a
          href="?timeframe={{ key }}"
          class="px-5 py-2 rounded-full text-xs font-bold uppercase tracking-wider transition-all duration-300 whitespace-nowrap {% if timeframe == key %} bg-slate-900 text-white shadow-md {% else %} text-slate-500 hover:text-slate-900 hover:bg-slate-100 {% endif %}"
        >
          {{ label }}
        </a>
        {% endfor %}
      </div>
    </div>

    {% if stats|length > 0 %}
    <!-- Summary KPI Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12" data-aos="fade-up">
      {% set total_reviews = namespace(value=0) %} {% set total_positive =
      namespace(value=0) %} {% set total_negative = namespace(value=0) %} {% for
      name, info in stats.items() %} {% set total_reviews.value =
      total_reviews.value + info.total %} {% set total_positive.value =
      total_positive.value + info.pos %} {% set total_negative.value =
      total_negative.value + info.neg %} {% endfor %} {% set overall_percentage
      = ((total_positive.value / total_reviews.value * 100) | round(1)) if
      total_reviews.value > 0 else 0 %}

      <!-- KPI 1 -->
      <div
        class="bg-white rounded-2xl p-6 border border-slate-100 shadow-[0_8px_30px_rgb(0,0,0,0.04)] hover:shadow-[0_8px_30px_rgb(0,0,0,0.08)] transition-shadow duration-300"
      >
        <div class="flex justify-between items-start">
          <div>
            <p
              class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1"
            >
              Total Volume
            </p>
            <h2 class="text-4xl font-black text-slate-800">
              {{ total_reviews.value }}
            </h2>
          </div>
          <div class="p-3 bg-blue-50 rounded-xl text-blue-600">
            <i class="fas fa-layer-group text-xl"></i>
          </div>
        </div>
        <div class="mt-4 flex items-center gap-2 text-sm text-slate-500">
          <span
            class="bg-slate-100 px-2 py-0.5 rounded text-xs font-bold text-slate-600"
          >
            {{ stats|length }} Faskes
          </span>
          <span>Terdaftar</span>
        </div>
      </div>

      <!-- KPI 2 -->
      <div
        class="bg-white rounded-2xl p-6 border border-slate-100 shadow-[0_8px_30px_rgb(0,0,0,0.04)] hover:shadow-[0_8px_30px_rgb(0,0,0,0.08)] transition-shadow duration-300"
      >
        <div class="flex justify-between items-start">
          <div>
            <p
              class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1"
            >
              Sentiment Score
            </p>
            <h2 class="text-4xl font-black text-emerald-600">
              {{ overall_percentage }}%
            </h2>
          </div>
          <div class="p-3 bg-emerald-50 rounded-xl text-emerald-600">
            <i class="fas fa-heart text-xl"></i>
          </div>
        </div>
        <div class="mt-4 flex items-center gap-2 text-sm text-slate-500">
          <span
            class="bg-emerald-100 px-2 py-0.5 rounded text-xs font-bold text-emerald-700"
          >
            {{ total_positive.value }}
          </span>
          <span>Ulasan Positif</span>
        </div>
      </div>

      <!-- KPI 3 -->
      <div
        class="bg-white rounded-2xl p-6 border border-slate-100 shadow-[0_8px_30px_rgb(0,0,0,0.04)] hover:shadow-[0_8px_30px_rgb(0,0,0,0.08)] transition-shadow duration-300"
      >
        <div class="flex justify-between items-start">
          <div>
            <p
              class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1"
            >
              Requires Attention
            </p>
            <h2 class="text-4xl font-black text-rose-500">
              {{ total_negative.value }}
            </h2>
          </div>
          <div class="p-3 bg-rose-50 rounded-xl text-rose-500">
            <i class="fas fa-bell text-xl"></i>
          </div>
        </div>
        <div class="mt-4 flex items-center gap-2 text-sm text-slate-500">
          <span
            class="bg-rose-100 px-2 py-0.5 rounded text-xs font-bold text-rose-700"
          >
            {{ (100 - overall_percentage) | round(1) }}%
          </span>
          <span>Tingkat Keluhan</span>
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Main Content: Hospital Grid -->
    <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 mb-16">
      {% for name, info in stats.items() %}
      <div
        class="bg-white rounded-2xl border border-slate-100 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 flex flex-col h-full group"
        data-aos="fade-up"
        data-aos-delay="{{ loop.index0 * 100 }}"
      >
        <!-- Header -->
        <div
          class="px-7 py-6 border-b border-slate-50 flex justify-between items-start"
        >
          <div class="flex gap-5 items-center">
            <!-- Circular Score Indicator -->
            <div class="relative w-14 h-14 flex-shrink-0">
              <svg class="w-full h-full transform -rotate-90">
                <circle
                  cx="28"
                  cy="28"
                  r="24"
                  stroke="#f1f5f9"
                  stroke-width="4"
                  fill="transparent"
                ></circle>
                <circle
                  cx="28"
                  cy="28"
                  r="24"
                  stroke="{% if info.score >= 75 %}#10b981{% elif info.score >= 50 %}#f59e0b{% else %}#ef4444{% endif %}"
                  stroke-width="4"
                  fill="transparent"
                  stroke-dasharray="150.72"
                  stroke-dashoffset="{{ 150.72 - (150.72 * info.score / 100) }}"
                  class="transition-all duration-1000 ease-out"
                ></circle>
              </svg>
              <span
                class="absolute inset-0 flex items-center justify-center text-xs font-black text-slate-700"
              >
                {{ info.score }}<span class="text-[8px]">%</span>
              </span>
            </div>

            <div>
              <h3
                class="font-bold text-lg text-slate-800 leading-snug group-hover:text-blue-600 transition-colors cursor-default"
              >
                {{ name }}
              </h3>
              <p
                class="text-xs font-medium text-slate-400 mt-1 flex items-center gap-1"
              >
                <span class="w-1.5 h-1.5 rounded-full bg-green-500"></span> Live
                Monitoring
              </p>
            </div>
          </div>

          <!-- Status Badge -->
          <span
            class="px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide border {% if info.score >= 75 %} bg-emerald-50 text-emerald-600 border-emerald-100 {% elif info.score >= 50 %} bg-amber-50 text-amber-600 border-amber-100 {% else %} bg-rose-50 text-rose-600 border-rose-100 {% endif %}"
          >
            {% if info.score >= 75 %} Excellent {% elif info.score >= 50 %}
            Moderate {% else %} Critical {% endif %}
          </span>
        </div>

        <!-- Body -->
        <div class="p-7 flex-grow flex flex-col justify-between">
          <!-- Stats Row -->
          <div class="grid grid-cols-2 gap-4 mb-6">
            <div
              class="bg-slate-50 p-3 rounded-lg text-center border border-slate-100"
            >
              <span class="block text-xl font-bold text-emerald-600"
                >{{ info.pos }}</span
              >
              <span
                class="text-[10px] uppercase font-bold text-slate-400 tracking-wider"
                >Positif</span
              >
            </div>
            <div
              class="bg-slate-50 p-3 rounded-lg text-center border border-slate-100"
            >
              <span class="block text-xl font-bold text-rose-500"
                >{{ info.neg }}</span
              >
              <span
                class="text-[10px] uppercase font-bold text-slate-400 tracking-wider"
                >Negatif</span
              >
            </div>
          </div>

          <!-- AI Insight Box -->
          <div
            class="relative bg-gradient-to-br from-slate-50 to-white rounded-xl p-5 border border-slate-100"
          >
            <div
              class="absolute top-0 left-0 w-1 h-full rounded-l-xl {% if info.score >= 75 %} bg-emerald-500 {% elif info.score >= 50 %} bg-amber-500 {% else %} bg-rose-500 {% endif %}"
            ></div>

            <div class="flex items-start gap-3">
              <div class="mt-0.5">
                <i class="fas fa-robot text-slate-400"></i>
              </div>
              <div>
                <h4 class="text-xs font-bold text-slate-800 uppercase mb-1">
                  AI Diagnostic Summary
                </h4>
                <p class="text-sm text-slate-600 leading-relaxed font-light">
                  {% if info.score >= 80 %} Performa sangat baik. Pasien
                  mengapresiasi kecepatan layanan dan keramahan staf.
                  Pertahankan standar ini. {% elif info.score >= 60 %} Kualitas
                  layanan stabil, namun terdeteksi beberapa isu terkait waktu
                  tunggu yang perlu optimasi operasional. {% else %}
                  <strong>Perhatian Diperlukan.</strong> Tingkat sentimen
                  negatif tinggi pada aspek fasilitas/layanan. Segera lakukan
                  evaluasi mendalam. {% endif %}
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Footer Action (Optional) -->
        <div
          class="px-7 py-4 bg-slate-50 border-t border-slate-100 flex justify-between items-center"
        >
          <span class="text-xs text-slate-400 font-medium"
            >Total {{ info.total }} Ulasan</span
          >
          <a
            href="{{ url_for('developer_page') }}"
            class="text-xs font-bold text-blue-600 hover:text-blue-800 flex items-center gap-1 transition-colors"
          >
            Detail Analisis <i class="fas fa-arrow-right text-[10px]"></i>
          </a>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Empty State -->
    {% if stats|length == 0 %}
    <div class="text-center py-20">
      <div
        class="w-24 h-24 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-6"
      >
        <i class="fas fa-inbox text-4xl text-slate-300"></i>
      </div>
      <h3 class="text-xl font-bold text-slate-900">Belum Ada Data</h3>
      <p class="text-slate-500 mt-2 mb-8">
        Tidak ada laporan yang ditemukan untuk filter waktu ini.
      </p>
      <a
        href="{{ url_for('input_page') }}"
        class="inline-flex items-center px-6 py-3 bg-slate-900 text-white rounded-lg font-bold hover:bg-black transition-colors shadow-lg"
      >
        <i class="fas fa-plus mr-2"></i> Buat Laporan Baru
      </a>
    </div>
    {% endif %}

    <!-- Footer Stats -->
    {% if stats|length > 0 %}
    <div
      class="border-t border-slate-200 pt-8 flex flex-col md:flex-row justify-between items-center gap-4 text-xs font-medium text-slate-400"
    >
      <div class="flex gap-6">
        <span class="flex items-center gap-2"
          ><div class="w-2 h-2 rounded-full bg-emerald-500"></div>
          System Operational</span
        >
        <span class="flex items-center gap-2"
          ><i class="fas fa-shield-alt"></i> AES-256 Encrypted</span
        >
      </div>
      <div class="font-mono">LAST SYNC: {{ now }}</div>
    </div>
    {% endif %}
  </div>
</section>

{% endblock %}
